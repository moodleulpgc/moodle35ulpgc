define(["qtype_stack/jsxgraphcore-lazy"],function(a){return{find_input_id:function(a,b){for(var c=document.getElementById(a);(c=c.parentElement)&&(!c.classList.contains("formulation")||!c.parentElement.classList.contains("content")););return c=c.querySelector('input[id$="_'+b+'"]'),c.addEventListener("change",function(a){M.core_formchangechecker.set_form_changed()}),c.id},bind_point:function(b,c){var d=document.getElementById(b);if(d.value&&""!=d.value){var e=JSON.parse(d.value);try{c.setPosition(a.COORDS_BY_USER,e)}catch(f){}c.board.update(),c.update()}var g=c.X(),h=c.Y();c.board.on("update",function(){if(g!==c.X()||h!==c.Y()){var a=JSON.stringify([c.X(),c.Y()]);if(g=!1,h=!1,d.value!=a&&(d.value=a,window.location.pathname.indexOf("preview.php")===-1)){var b=new Event("change");d.dispatchEvent(b)}}});var i=JSON.stringify([c.X(),c.Y()]);d.addEventListener("input",function(b){if(d.value!=i){try{var e=JSON.parse(d.value);"number"==typeof e[0]&&"number"==typeof e[1]&&(c.setPosition(a.COORDS_BY_USER,e),c.board.update(),c.update())}catch(f){}i=d.value}}),d.addEventListener("change",function(b){if(d.value!=i){try{var e=JSON.parse(d.value);"number"==typeof e[0]&&"number"==typeof e[1]&&(c.setPosition(a.COORDS_BY_USER,e),c.board.update(),c.update())}catch(f){}i=d.value}})},bind_point_dual:function(b,c,d){var e=document.getElementById(b);if(e.value&&""!=e.value){var f=JSON.parse(e.value);try{c.setPosition(a.COORDS_BY_USER,f[0]),d.setPosition(a.COORDS_BY_USER,f[1])}catch(g){}c.board.update(),c.update(),d.board.update(),d.update()}var h=c.X(),i=c.Y();c.board.on("update",function(){if(h!==c.X()||i!==c.Y()){var a=JSON.stringify([[c.X(),c.Y()],[d.X(),d.Y()]]);if(h=!1,i=!1,e.value!=a&&(e.value=a,window.location.pathname.indexOf("preview.php")===-1)){var b=new Event("change");e.dispatchEvent(b)}}});var j=d.X(),k=d.Y();d.board.on("update",function(){if(j!==d.X()||k!==d.Y()){var a=JSON.stringify([[c.X(),c.Y()],[d.X(),d.Y()]]);if(j=!1,k=!1,e.value!=a&&(e.value=a,window.location.pathname.indexOf("preview.php")===-1)){var b=new Event("change");e.dispatchEvent(b)}}});var l=JSON.stringify([[c.X(),c.Y()],[d.X(),d.Y()]]);e.addEventListener("input",function(b){if(e.value!=l){try{var f=JSON.parse(e.value);"number"==typeof f[0][0]&&"number"==typeof f[0][1]&&c.setPosition(a.COORDS_BY_USER,f[0]),"number"==typeof f[1][0]&&"number"==typeof f[1][1]&&(d.setPosition(a.COORDS_BY_USER,f[1]),c.board.update(),c.update(),d.board.update(),d.update())}catch(g){}l=e.value}}),e.addEventListener("change",function(b){if(e.value!=l){try{var f=JSON.parse(e.value);"number"==typeof f[0][0]&&"number"==typeof f[0][1]&&c.setPosition(a.COORDS_BY_USER,f[0]),"number"==typeof f[1][0]&&"number"==typeof f[1][1]&&(d.setPosition(a.COORDS_BY_USER,f[1]),c.board.update(),c.update(),d.board.update(),d.update())}catch(g){}l=e.value}})},bind_point_relative:function(b,c,d){var e=document.getElementById(b);if(e.value&&""!=e.value){var f=JSON.parse(e.value);try{c.setPosition(a.COORDS_BY_USER,f[0]);var g=[f[0][0]+f[1][0],f[0][1]+f[1][1]];d.setPosition(a.COORDS_BY_USER,g)}catch(h){}c.board.update(),c.update(),d.board.update(),d.update()}var i=c.X(),j=c.Y();c.board.on("update",function(){if(i!==c.X()||j!==c.Y()){var a=JSON.stringify([[c.X(),c.Y()],[d.X()-c.X(),d.Y()-c.Y()]]);if(i=!1,j=!1,e.value!=a&&(e.value=a,window.location.pathname.indexOf("preview.php")===-1)){var b=new Event("change");e.dispatchEvent(b)}}});var k=d.X(),l=d.Y();d.board.on("update",function(){if(k!==d.X()||l!==d.Y()){var a=JSON.stringify([[c.X(),c.Y()],[d.X()-c.X(),d.Y()-c.Y()]]);if(k=!1,l=!1,e.value!=a&&(e.value=a,window.location.pathname.indexOf("preview.php")===-1)){var b=new Event("change");e.dispatchEvent(b)}}});var m=JSON.stringify([[c.X(),c.Y()],[d.X()-c.X(),d.Y()-c.Y()]]);e.addEventListener("input",function(b){if(e.value!=m){try{var f=JSON.parse(e.value);if("number"==typeof f[0][0]&&"number"==typeof f[0][1]&&c.setPosition(a.COORDS_BY_USER,f[0]),"number"==typeof f[1][0]&&"number"==typeof f[1][1]){var g=[f[0][0]+f[1][0],f[0][1]+f[1][1]];d.setPosition(a.COORDS_BY_USER,g),c.board.update(),c.update(),d.board.update(),d.update()}}catch(h){}m=e.value}}),e.addEventListener("change",function(b){if(e.value!=m){try{var f=JSON.parse(e.value);if("number"==typeof f[0][0]&&"number"==typeof f[0][1]&&c.setPosition(a.COORDS_BY_USER,f[0]),"number"==typeof f[1][0]&&"number"==typeof f[1][1]){var g=[f[0][0]+f[1][0],f[0][1]+f[1][1]];d.setPosition(a.COORDS_BY_USER,g),c.board.update(),c.update(),d.board.update(),d.update()}}catch(h){}m=e.value}})},bind_point_direction:function(b,c,d){var e=document.getElementById(b);if(e.value&&""!=e.value){var f=JSON.parse(e.value);try{c.setPosition(a.COORDS_BY_USER,f[0]);var g=f[1][0],h=f[1][1],i=[f[0][0],f[0][1]];h>0&&(i[0]=i[0]+h*Math.cos(g),i[1]=i[1]+h*Math.sin(g)),d.setPosition(a.COORDS_BY_USER,i)}catch(j){}c.board.update(),c.update(),d.board.update(),d.update()}var k=c.X(),l=c.Y();c.board.on("update",function(){if(k!==c.X()||l!==c.Y()){var a=JSON.stringify([[c.X(),c.Y()],[Math.atan2(d.Y()-c.Y(),d.X()-c.X()),Math.sqrt((d.X()-c.X())*(d.X()-c.X())+(d.Y()-c.Y())*(d.Y()-c.Y()))]]);if(k=!1,l=!1,e.value!=a&&(e.value=a,window.location.pathname.indexOf("preview.php")===-1)){var b=new Event("change");e.dispatchEvent(b)}}});var m=d.X(),n=d.Y();d.board.on("update",function(){if(m!==d.X()||n!==d.Y()){var a=JSON.stringify([[c.X(),c.Y()],[Math.atan2(d.Y()-c.Y(),d.X()-c.X()),Math.sqrt((d.X()-c.X())*(d.X()-c.X())+(d.Y()-c.Y())*(d.Y()-c.Y()))]]);if(m=!1,n=!1,e.value!=a&&(e.value=a,window.location.pathname.indexOf("preview.php")===-1)){var b=new Event("change");e.dispatchEvent(b)}}});var o=JSON.stringify([[c.X(),c.Y()],[Math.atan2(d.Y()-c.Y(),d.X()-c.X()),Math.sqrt((d.X()-c.X())*(d.X()-c.X())+(d.Y()-c.Y())*(d.Y()-c.Y()))]]);e.addEventListener("input",function(b){if(e.value!=o){try{var f=JSON.parse(e.value);if("number"==typeof f[0][0]&&"number"==typeof f[0][1]&&c.setPosition(a.COORDS_BY_USER,f[0]),"number"==typeof f[1][0]&&"number"==typeof f[1][1]){var g=f[1][0],h=f[1][1],i=[f[0][0],f[0][1]];h>0&&(i[0]=i[0]+h*Math.cos(g),i[1]=i[1]+h*Math.sin(g)),d.setPosition(a.COORDS_BY_USER,i),c.board.update(),c.update(),d.board.update(),d.update()}}catch(j){}o=e.value}}),e.addEventListener("change",function(b){if(e.value!=o){try{var f=JSON.parse(e.value);if("number"==typeof f[0][0]&&"number"==typeof f[0][1]&&c.setPosition(a.COORDS_BY_USER,f[0]),"number"==typeof f[1][0]&&"number"==typeof f[1][1]){var g=f[1][0],h=f[1][1],i=[f[0][0],f[0][1]];h>0&&(i[0]=i[0]+h*Math.cos(g),i[1]=i[1]+h*Math.sin(g)),d.setPosition(a.COORDS_BY_USER,i),c.board.update(),c.update(),d.board.update(),d.update()}}catch(j){}o=e.value}})},bind_slider:function(a,b){var c=document.getElementById(a);if(c.value&&""!=c.value){try{b.setValue(JSON.parse(c.value))}catch(d){}b.board.update(),b.update()}var e=b.Value();b.board.on("update",function(){if(e!=b.Value()){var a=JSON.stringify(b.Value());if(e=!1,c.value!=a&&(c.value=a,window.location.pathname.indexOf("preview.php")===-1)){var d=new Event("change");c.dispatchEvent(d)}}});var f=JSON.stringify(b.Value());c.addEventListener("input",function(a){if(c.value!==f){try{var d=JSON.parse(c.value);"number"==typeof d&&(b.setValue(d),b.board.update(),b.update())}catch(e){}f=c.value}}),c.addEventListener("change",function(a){if(c.value!==f){try{var d=JSON.parse(c.value);"number"==typeof d&&(b.setValue(d),b.board.update(),b.update())}catch(e){}f=c.value}})}}});