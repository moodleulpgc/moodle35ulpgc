define(["jquery","qtype_coderunner/userinterfacewrapper"],function(a,b){function c(c,e){function f(d,f){var g,h,i,j=a(document.getElementById(d));f=f.toLowerCase(),"none"===f&&(f=""),g=j.data("current-ui-wrapper");try{h=window.JSON.parse(e)}catch(k){h={}}"ace"===f&&("id_templateparams"==d?i="":(i=v.prop("value"),"id_template"!==d&&w.prop("value")&&(i=n(w.prop("value")))),h.lang=i),g&&g.uiname===f&&g.params===h||(g?g.loadUi(f,h):g=new b.InterfaceWrapper(f,d,c,h))}function g(){var a=L.val();a&&(f("id_answer",a),f("id_answerpreload",a))}function h(a){var b=a?"block":"none";B.css("display",b),C.css("display",b),a&&u.prop("checked")&&f("id_template","ace")}function i(){var a=y.prop("checked");z.prop("disabled",!a),A.prop("disabled",!a)}function j(b,c){var e,f,g;for(var j in d)e=d[j],f=c[j]?c[j]:e[2],e.length>3&&(g=e[3],f=g(f)),a(e[0]).prop(e[1],f);G.prop("value",b),x.prop("checked",!1),I.html(l(b,c.questiontext)),h(!1),i()}function k(a,b){var c;window.alert(m("prototype_load_failure")+b),c=m("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+H+", qtype: "+a,t.prop("value",c)}function l(a,b){var c='<p class="question-type-details-header">';return c+=m("coderunner_question_type"),c+=a+"</p>\n"+b}function m(a){return c[a]}function n(a){var b,c;if(a.indexOf(",")<0)return a;for(b=a.split(","),c=0;c<b.length;c++)if(b[c].endsWith("*"))return b[c].substr(0,b[c].length-1);return b.length>0?b[0]:""}function o(){var b=s.children("option:selected").text();""!==b&&"Undefined"!==b&&(s.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:H,sesskey:M.cfg.sesskey},function(a){a.success?(j(b,a),g()):k(b,a.error)}).fail(function(){window.alert(m("error_loading_prototype")),t.prop("value",m("ajax_error"))}))}function p(){"3"===J.val()?K.show():K.hide()}function q(){"ace"===L.val()&&g()}function r(){u.prop("checked")&&f("id_template","ace")}var s=a("#id_coderunnertype"),t=a("#id_template"),u=a("#id_useace"),v=a("#id_language"),w=a("#id_acelang"),x=a("#id_customise"),y=a("#id_iscombinatortemplate"),z=a("#id_testsplitterre"),A=a("#id_allowmultiplestdins"),B=a("#id_customisationheader"),C=a("#id_advancedcustomisationheader"),D=x.prop("checked"),E=a("#id_prototypetype"),F=a("#id_answerpreloadhdr"),G=a("#id_typename"),H=a('input[name="courseid"]').prop("value"),I=a("#qtype-help"),J=a("select#id_precheck"),K=a("div.testtype"),L=a("#id_uiplugin");1==E.prop("value")&&(window.alert(m("proceed_at_own_risk")),E.prop("disabled",!0),s.prop("disabled",!0),x.prop("disabled",!0)),h(D),D?(g(),I.html("<p>"+m("info_unavailable")+"</p>")):o(),p(),u.prop("checked")&&f("id_templateparams","ace"),x.on("change",function(){var a=x.prop("checked");a?h(!0):window.confirm(m("confirm_proceed"))?h(!1):x.prop("checked",!0)}),w.on("change",q),v.on("change",function(){r(),q()}),s.on("change",function(){x.prop("checked")&&!window.confirm(m("question_type_changed"))||o()}),u.on("change",function(){var a=u.prop("checked");a?(f("id_template","ace"),f("id_templateparams","ace")):(f("id_template",""),f("id_templateparams",""))}),L.on("change",g),J.on("change",p);var N=new MutationObserver(function(){g()});N.observe(F.get(0),{attributes:!0}),a("button.replaceexpectedwithgot").click(function(){var b=a(this).prev('pre[id^="id_got_"]'),c=b.attr("id").replace("id_got_","");a("#id_expected_"+c).val(b.text()),a("#id_fail_expected_"+c).html(b.text()),a(".failrow_"+c).addClass("fixed"),a(this).prop("disabled",!0)})}var d={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],allowmultiplestdins:["#id_allowmultiplestdins","checked","",function(a){return"1"===a}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""],uiplugin:["#id_uiplugin","value","ace"]};return{initEditForm:c}});